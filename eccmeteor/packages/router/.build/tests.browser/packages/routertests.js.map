{"version":3,"file":"\\packages\\router:tests.js","sources":["router/tests\\router_client_tests.js","router/tests\\router_common_tests.js"],"names":[],"mappings":";;;;;;;;AAAA,4C;AACA,+B;AACA,qB;AACA,kB;AACA,8B;AACA,4B;AACA,mB;AACA,K;AACA,K;AACA,qD;AACA,kC;AACA,kB;AACA,K;AACA,E;AACA,yC;AACA,E;AACA,2B;AACA,0C;AACA,E;AACA,6B;AACA,0C;AACA,qC;AACA,E;AACA,8B;AACA,2C;AACA,yC;AACA,G;;AAEA,kD;AACA,yB;AACA,+B;AACA,qB;AACA,kB;AACA,kB;AACA,0B;AACA,+B;AACA,yC;AACA,mB;AACA,K;AACA,I;AACA,E;AACA,6B;AACA,yB;AACA,wB;AACA,K;AACA,E;AACA,gC;AACA,E;AACA,0B;AACA,gB;AACA,gC;AACA,E;AACA,0B;AACA,gB;AACA,gC;AACA,E;AACA,kD;AACA,4B;AACA,gB;AACA,gC;AACA,G;;AAEA,iD;AACA,+B;AACA,qB;AACA,kB;AACA,kB;AACA,iB;AACA,I;AACA,E;AACA,yB;AACA,8D;AACA,kD;AACA,I;AACA,wD;AACA,qE;AACA,E;AACA,2B;AACA,qD;AACA,E;AACA,2B;AACA,oD;AACA,E;AACA,2B;AACA,0C;AACA,G;;AAEA,iE;AACA,+B;AACA,mC;AACA,E;AACA,yB;AACA,sC;AACA,0C;AACA,gC;AACA,c;AACA,oB;AACA,O;AACA,K;AACA,K;AACA,yC;AACA,E;AACA,sC;AACA,iB;AACA,2B;AACA,0C;AACA,E;AACA,sC;AACA,iB;AACA,qD;AACA,G;;AAEA,2D;AACA,+B;AACA,4C;AACA,E;AACA,4D;AACA,uE;AACA,E;AACA,sC;AACA,iB;AACA,4C;AACA,G;;AAEA,kE;AACA,+B;AACA,qB;AACA,uB;AACA,8C;AACA,+E;AACA,2C;AACA,K;AACA,E;AACA,e;AACA,4B;AACA,iB;AACA,4C;AACA,E;AACA,0B;AACA,0B;AACA,8B;AACA,I;AACA,E;AACA,0B;AACA,4B;AACA,iB;AACA,4C;AACA,0C;AACA,E;AACA,0B;AACA,8B;AACA,K;AACA,oD;AACA,6B;AACA,iB;AACA,4C;AACA,G;;AAEA,sD;AACA,2B;AACA,E;AACA,+B;AACA,yC;AACA,4C;AACA,wB;AACA,G;AACA,E;AACA,kC;AACA,8B;AACA,iC;AACA,G;;AAEA,gE;AACA,2B;AACA,E;AACA,+B;AACA,E;AACA,4C;AACA,mE;AACA,G;;AAEA,8B;AACA,iB;AACA,4C;AACA,E;AACA,4C;AACA,oD;AACA,c;AACA,G;;AAEA,8B;AACA,4C;AACA,G;;;;;;;;;;;;;;;;;;AChMA,6C;AACA,qD;AACA,E;AACA,kB;AACA,0D;AACA,8B;AACA,E;AACA,c;AACA,0D;AACA,yB;AACA,E;AACA,4D;AACA,qD;AACA,G","sourcesContent":["Tinytest.add(\"Router page\", function(test) {\r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add({\r\n    '/foo': 'foo',\r\n    '/bar/:id': function(id) {\r\n      Session.set('id', id);\r\n      return 'bar';\r\n    }\r\n  });\r\n  Meteor.Router.add(/page\\/(\\d+)/, function(number) {\r\n    Session.set('pageNo', number);\r\n    return 'page';\r\n  });\r\n  \r\n  test.equal(Meteor.Router.page(), null);\r\n  \r\n  Meteor.Router.to('/foo');\r\n  test.equal(Meteor.Router.page(), 'foo');\r\n  \r\n  Meteor.Router.to('/bar/1');\r\n  test.equal(Meteor.Router.page(), 'bar');\r\n  test.equal(Session.get('id'), '1');\r\n  \r\n  Meteor.Router.to('/page/7');\r\n  test.equal(Meteor.Router.page(), 'page');\r\n  test.equal(Session.get('pageNo'), '7');\r\n});\r\n\r\nTinytest.add(\"Router reactivity\", function(test) {\r\n  var context_called = 0;\r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add({\r\n    '/foo': 'foo',\r\n    '/bar': 'bar',\r\n    '/bar/2': function() {\r\n      // do something unrelated\r\n      Session.set('router-test-page', 2);\r\n      return 'bar';\r\n    }\r\n  })\r\n  \r\n  Meteor.autorun(function() {\r\n    Meteor.Router.page();\r\n    context_called += 1;\r\n  });\r\n  \r\n  test.equal(context_called, 1);\r\n  \r\n  Meteor.Router.to('/foo')\r\n  Meteor.flush()\r\n  test.equal(context_called, 2);\r\n  \r\n  Meteor.Router.to('/bar')\r\n  Meteor.flush()\r\n  test.equal(context_called, 3);\r\n  \r\n  // returns 'bar' to shouldn't trigger reactivity\r\n  Meteor.Router.to('/bar/2')\r\n  Meteor.flush()\r\n  test.equal(context_called, 3);\r\n});\r\n\r\nTinytest.add(\"Router filtering\", function(test) {\r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add({\r\n    '/foo': 'foo',\r\n    '/bar': 'bar',\r\n    '/baz': 'baz'\r\n  })\r\n  \r\n  Meteor.Router.filters({\r\n    'something_else': function() { return 'something_else'; },\r\n    'third': function() { return 'a third thing' }\r\n  })\r\n  Meteor.Router.filter('something_else', {only: 'foo'});\r\n  Meteor.Router.filter('third', {except: ['something_else', 'baz']});\r\n  \r\n  Meteor.Router.to('/foo');\r\n  test.equal(Meteor.Router.page(), 'something_else');\r\n  \r\n  Meteor.Router.to('/bar');\r\n  test.equal(Meteor.Router.page(), 'a third thing');\r\n  \r\n  Meteor.Router.to('/baz');\r\n  test.equal(Meteor.Router.page(), 'baz');\r\n});\r\n\r\nTinytest.add(\"FilteredRouter filter reactivity\", function(test) {\r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add('/foo', 'foo');\r\n  \r\n  Meteor.Router.filters({\r\n    'something_else': function(page) {\r\n      if (Session.get('something_else')) {\r\n        return 'something_else';\r\n      } else {\r\n        return page;\r\n      }\r\n    }\r\n  });\r\n  Meteor.Router.filter('something_else');\r\n  \r\n  Session.set('something_else', null);\r\n  Meteor.flush();\r\n  Meteor.Router.to('/foo');\r\n  test.equal(Meteor.Router.page(), 'foo');\r\n  \r\n  Session.set('something_else', true);\r\n  Meteor.flush();\r\n  test.equal(Meteor.Router.page(), 'something_else');\r\n});\r\n\r\nTinytest.add(\"Router named route helpers\", function(test) {\r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add('/named/:arg', 'named');\r\n  \r\n  test.equal(Meteor.Router.namedPath({arg: 7}), '/named/7');\r\n  test.equal(Meteor.Router.namedUrl(7), Meteor.absoluteUrl('named/7'));\r\n  \r\n  Meteor.Router.to('named', {arg: 7});\r\n  Meteor.flush();\r\n  test.equal(Meteor.Router.page(), 'named');\r\n});\r\n\r\nTinytest.add(\"Router different argument formats\", function(test) {\r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add({\r\n    '/route1': 'page1',\r\n    '/route2': function() { return 'page2'; },\r\n    '/route3': {to: 'page3', and: function() { Session.set('foo', 'page3'); }},\r\n    '/route4': {to: 'page4', as: 'route4'},\r\n  });\r\n  \r\n  // simple one\r\n  Meteor.Router.to('page1');\r\n  Meteor.flush();\r\n  test.equal(Meteor.Router.page(), 'page1');\r\n  \r\n  // no named route exists\r\n  test.throws(function() {\r\n    Meteor.Router.to('page2');\r\n  })\r\n  \r\n  // slightly more complex\r\n  Meteor.Router.to('page3');\r\n  Meteor.flush();\r\n  test.equal(Meteor.Router.page(), 'page3');\r\n  test.equal(Session.get('foo'), 'page3');\r\n  \r\n  test.throws(function() {\r\n    Meteor.Router.to('page4');\r\n  });\r\n  test.equal(Meteor.Router.route4Path(), '/route4');\r\n  Meteor.Router.to('route4');\r\n  Meteor.flush();\r\n  test.equal(Meteor.Router.page(), 'page4');\r\n});\r\n\r\nTinytest.add(\"Router before routing\", function(test) {\r\n  var beforeCalled = false;\r\n  \r\n  Meteor.Router.resetFilters();\r\n  Meteor.Router.add('/before', 'before');\r\n  Meteor.Router.beforeRouting = function() {\r\n    beforeCalled = true;\r\n  }\r\n  \r\n  test.equal(beforeCalled, false);\r\n  Meteor.Router.to('/before');\r\n  test.equal(beforeCalled, true);\r\n});\r\n\r\nTinytest.add(\"Router before routing interrupt\", function(test) {\r\n  var beforeCalled = false;\r\n  \r\n  Meteor.Router.resetFilters();\r\n  \r\n  Meteor.Router.beforeRouting = function() {\r\n\t// a method (i.e. returns undefined) should not interrupt routing \r\n  }\r\n\r\n  Meteor.Router.to('/route1');\r\n  Meteor.flush();\r\n  test.equal(Meteor.Router.page(), 'page1');\r\n  \r\n  Meteor.Router.beforeRouting = function() {\r\n\t// returning false should interrupt (block) routing\r\n\treturn false;\r\n  }\r\n\r\n  Meteor.Router.to('/route2');\r\n  test.equal(Meteor.Router.page(), 'page1');\r\n});","Tinytest.add(\"Route basics\", function(test) {\r\n  var route = new Meteor.Router.Route('/posts/:_id');\r\n  \r\n  var params = {};\r\n  test.equal(route.match('/posts/7', null, params), true);\r\n  test.equal(params._id, '7');\r\n  \r\n  params = {};\r\n  test.equal(route.match('/posts/', null, params), false);\r\n  test.equal(params, {});\r\n  \r\n  test.equal(route.pathWithContext({_id: 10}), '/posts/10');\r\n  test.equal(route.pathWithContext(10), '/posts/10');\r\n});"]}