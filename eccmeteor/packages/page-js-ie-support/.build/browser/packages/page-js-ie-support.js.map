{"version":3,"file":"\\packages\\page-js-ie-support.js","sources":["page-js-ie-support/page-js\\index.js"],"names":[],"mappings":";;;;;;;;AAAA,a;;AAEA,K;AACA,8B;AACA,K;;AAEA,sB;;AAEA,K;AACA,e;AACA,K;;AAEA,gB;;AAEA,K;AACA,kB;AACA,K;;AAEA,c;;AAEA,K;AACA,kC;AACA,uF;AACA,K;AACA,qD;;AAEA,K;AACA,0C;AACA,wC;AACA,I;AACA,gB;AACA,qB;AACA,qC;AACA,mD;AACA,gC;AACA,c;AACA,I;AACA,kC;AACA,4B;AACA,gB;AACA,K;;AAEA,2B;AACA,iB;AACA,oC;AACA,6B;AACA,K;;AAEA,qC;AACA,kC;AACA,kC;AACA,kD;AACA,4D;AACA,O;AACA,+B;AACA,yC;AACA,0B;AACA,sB;AACA,Y;AACA,uB;AACA,K;AACA,G;;AAEA,K;AACA,wB;AACA,K;;AAEA,sB;;AAEA,K;AACA,mC;AACA,I;AACA,yB;AACA,gB;AACA,K;;AAEA,6B;AACA,2C;AACA,gB;AACA,I;;AAEA,K;AACA,mC;AACA,I;AACA,a;AACA,I;AACA,6C;AACA,4C;AACA,oD;AACA,I;AACA,4B;AACA,gB;AACA,K;;AAEA,iC;AACA,4B;AACA,wB;AACA,mB;AACA,qD;AACA,6E;AACA,sE;AACA,0B;AACA,4E;AACA,I;;AAEA,K;AACA,8C;AACA,I;AACA,gB;AACA,K;;AAEA,yB;AACA,oB;AACA,4C;AACA,gD;AACA,I;;AAEA,K;AACA,8C;AACA,I;AACA,yB;AACA,0B;AACA,8B;AACA,sB;AACA,gB;AACA,K;;AAEA,8C;AACA,uC;AACA,+C;AACA,wC;AACA,e;AACA,I;;AAEA,K;AACA,iD;AACA,I;AACA,yB;AACA,0B;AACA,sB;AACA,gB;AACA,K;;AAEA,uD;AACA,uC;AACA,oB;AACA,0C;AACA,qC;AACA,e;AACA,e;AACA,I;;AAEA,K;AACA,8B;AACA,I;AACA,wB;AACA,iB;AACA,K;;AAEA,gC;AACA,c;;AAEA,qB;AACA,mC;AACA,qC;AACA,oB;AACA,K;;AAEA,W;AACA,I;;AAEA,K;AACA,+C;AACA,kD;AACA,gD;AACA,I;AACA,yB;AACA,iB;AACA,K;;AAEA,2B;AACA,yE;AACA,gB;AACA,yB;AACA,wC;AACA,G;;AAEA,K;AACA,yC;AACA,wD;AACA,I;AACA,yB;AACA,0B;AACA,gB;AACA,K;;AAEA,iC;AACA,sE;AACA,8B;AACA,8B;AACA,8C;AACA,gC;AACA,6B;AACA,2B;AACA,mD;AACA,iD;AACA,qB;AACA,G;;AAEA,K;AACA,sB;AACA,K;;AAEA,yB;;AAEA,K;AACA,gB;AACA,I;AACA,iB;AACA,K;;AAEA,2C;AACA,kE;AACA,I;;AAEA,K;AACA,4B;AACA,I;AACA,gB;AACA,K;;AAEA,sC;AACA,qE;AACA,I;;AAEA,K;AACA,mD;AACA,+C;AACA,I;AACA,a;AACA,I;AACA,oD;AACA,mE;AACA,I;AACA,yB;AACA,6B;AACA,iB;AACA,K;;AAEA,iC;AACA,4B;AACA,qB;AACA,wB;AACA,mC;AACA,sB;AACA,yB;AACA,wB;AACA,G;;AAEA,K;AACA,oB;AACA,K;;AAEA,qB;;AAEA,K;AACA,iC;AACA,+B;AACA,I;AACA,yB;AACA,uB;AACA,gB;AACA,K;;AAEA,4C;AACA,oB;AACA,+B;AACA,iE;AACA,a;AACA,K;AACA,I;;AAEA,K;AACA,8C;AACA,uB;AACA,I;AACA,yB;AACA,0B;AACA,sB;AACA,iB;AACA,K;;AAEA,iD;AACA,wB;AACA,mC;AACA,2D;AACA,uC;;AAEA,yB;;AAEA,mD;AACA,4B;;AAEA,uC;AACA,kC;AACA,e;;AAEA,gB;AACA,yD;AACA,4B;AACA,gB;AACA,c;AACA,yB;AACA,O;AACA,K;;AAEA,gB;AACA,I;;AAEA,K;AACA,qC;AACA,oC;AACA,I;AACA,qC;AACA,uC;AACA,4C;AACA,yB;AACA,I;AACA,uC;AACA,yB;AACA,gC;AACA,6B;AACA,qB;AACA,iB;AACA,K;;AAEA,wD;AACA,4C;AACA,iE;AACA,e;AACA,iC;AACA,+B;AACA,0G;AACA,wD;AACA,4B;AACA,iB;AACA,mC;AACA,iB;AACA,mC;AACA,qF;AACA,6B;AACA,Q;AACA,kC;AACA,8B;AACA,8D;AACA,I;;AAEA,K;AACA,8B;AACA,K;;AAEA,0B;AACA,kB;AACA,8B;AACA,kC;AACA,K;AACA,G;;AAEA,K;AACA,2B;AACA,K;;AAEA,uB;AACA,0B;AACA,qD;AACA,mC;AACA,sC;AACA,wD;AACA,0C;AACA,uB;AACA,uC;AACA,I;AACA,yE;AACA,6E;AACA,6B;AACA,wB;AACA,wB;AACA,I;AACA,0D;AACA,kC;AACA,oB;AACA,kC;AACA,qC;AACA,kE;AACA,oB;AACA,G;;AAEA,K;AACA,kB;AACA,K;;AAEA,qB;AACA,0B;AACA,0B;AACA,qB;AACA,qB;AACA,G;AACA,E;AACA,K;AACA,wC;AACA,K;;AAEA,6B;AACA,8D;AACA,qD;AACA,qC;AACA,G;AACA,E;AACA,K;AACA,mC;AACA,K;;AAEA,qC;AACA,gC;AACA,6C;AACA,a;AACA,wC;AACA,M;AACA,I;;AAEA,wC;AACA,mC;AACA,gD;AACA,a;AACA,wC;AACA,M;AACA,I;;AAEA,K;AACA,mB;AACA,K;;AAEA,qC;AACA,uB;AACA,U;AACA,0B;AACA,G;;AAEA,K","sourcesContent":[";(function(){\r\n\r\n  /**\r\n   * Perform initial dispatch.\r\n   */\r\n\r\n  var dispatch = true;\r\n\r\n  /**\r\n   * Base path.\r\n   */\r\n\r\n  var base = '';\r\n\r\n  /**\r\n   * Running flag.\r\n   */\r\n\r\n  var running;\r\n\r\n  /**\r\n   * To work properly with the URL\r\n   * history.location generated polyfill in https://github.com/devote/HTML5-History-API\r\n   */\r\n  var location = history.location || window.location;\r\n\r\n  /**\r\n   * Register `path` with callback `fn()`,\r\n   * or route `path`, or `page.start()`.\r\n   *\r\n   *   page(fn);\r\n   *   page('*', fn);\r\n   *   page('/user/:id', load, user);\r\n   *   page('/user/' + user.id, { some: 'thing' });\r\n   *   page('/user/' + user.id);\r\n   *   page();\r\n   *\r\n   * @param {String|Function} path\r\n   * @param {Function} fn...\r\n   * @api public\r\n   */\r\n\r\n  function page(path, fn) {\r\n    // <callback>\r\n    if ('function' == typeof path) {\r\n      return page('*', path);\r\n    }\r\n\r\n    // route <path> to <callback ...>\r\n    if ('function' == typeof fn) {\r\n      var route = new Route(path);\r\n      for (var i = 1; i < arguments.length; ++i) {\r\n        page.callbacks.push(route.middleware(arguments[i]));\r\n      }\r\n    // show <path> with [state]\r\n    } else if ('string' == typeof path) {\r\n      page.show(path, fn);\r\n    // start [options]\r\n    } else {\r\n      page.start(path);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Callback functions.\r\n   */\r\n\r\n  page.callbacks = [];\r\n\r\n  /**\r\n   * Get or set basepath to `path`.\r\n   *\r\n   * @param {String} path\r\n   * @api public\r\n   */\r\n\r\n  page.base = function(path){\r\n    if (0 == arguments.length) return base;\r\n    base = path;\r\n  };\r\n\r\n  /**\r\n   * Bind with the given `options`.\r\n   *\r\n   * Options:\r\n   *\r\n   *    - `click` bind to click events [true]\r\n   *    - `popstate` bind to popstate [true]\r\n   *    - `dispatch` perform initial dispatch [true]\r\n   *\r\n   * @param {Object} options\r\n   * @api public\r\n   */\r\n\r\n  page.start = function(options){\r\n    options = options || {};\r\n    if (running) return;\r\n    running = true;\r\n    if (false === options.dispatch) dispatch = false;\r\n    if (false !== options.popstate) addEvent(window, 'popstate', onpopstate);\r\n    if (false !== options.click) addEvent(document, 'click', onclick);\r\n    if (!dispatch) return;\r\n    page.replace(location.pathname + location.search, null, true, dispatch);\r\n  };\r\n\r\n  /**\r\n   * Unbind click and popstate event handlers.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  page.stop = function(){\r\n    running = false;\r\n    removeEvent(document, 'click', onclick);\r\n    removeEvent(window, 'popstate', onpopstate);\r\n  };\r\n\r\n  /**\r\n   * Show `path` with optional `state` object.\r\n   *\r\n   * @param {String} path\r\n   * @param {Object} state\r\n   * @param {Boolean} dispatch\r\n   * @return {Context}\r\n   * @api public\r\n   */\r\n\r\n  page.show = function(path, state, dispatch){\r\n    var ctx = new Context(path, state);\r\n    if (false !== dispatch) page.dispatch(ctx);\r\n    if (!ctx.unhandled) ctx.pushState();\r\n    return ctx;\r\n  };\r\n\r\n  /**\r\n   * Replace `path` with optional `state` object.\r\n   *\r\n   * @param {String} path\r\n   * @param {Object} state\r\n   * @return {Context}\r\n   * @api public\r\n   */\r\n\r\n  page.replace = function(path, state, init, dispatch){\r\n    var ctx = new Context(path, state);\r\n    ctx.init = init;\r\n    if (null == dispatch) dispatch = true;\r\n    if (dispatch) page.dispatch(ctx);\r\n    ctx.save();\r\n    return ctx;\r\n  };\r\n\r\n  /**\r\n   * Dispatch the given `ctx`.\r\n   *\r\n   * @param {Object} ctx\r\n   * @api private\r\n   */\r\n\r\n  page.dispatch = function(ctx){\r\n    var i = 0;\r\n\r\n    function next() {\r\n      var fn = page.callbacks[i++];\r\n      if (!fn) return unhandled(ctx);\r\n      fn(ctx, next);\r\n    }\r\n\r\n    next();\r\n  };\r\n\r\n  /**\r\n   * Unhandled `ctx`. When it's not the initial\r\n   * popstate then redirect. If you wish to handle\r\n   * 404s on your own use `page('*', callback)`.\r\n   *\r\n   * @param {Context} ctx\r\n   * @api private\r\n   */\r\n\r\n  function unhandled(ctx) {\r\n    if (location.pathname + location.search == ctx.canonicalPath) return;\r\n    page.stop();\r\n    ctx.unhandled = true;\r\n    window.location = ctx.canonicalPath;\r\n  }\r\n\r\n  /**\r\n   * Initialize a new \"request\" `Context`\r\n   * with the given `path` and optional initial `state`.\r\n   *\r\n   * @param {String} path\r\n   * @param {Object} state\r\n   * @api public\r\n   */\r\n\r\n  function Context(path, state) {\r\n    if ('/' == path[0] && 0 != path.indexOf(base)) path = base + path;\r\n    var i = path.indexOf('?');\r\n    this.canonicalPath = path;\r\n    this.path = path.replace(base, '') || '/';\r\n    this.title = document.title;\r\n    this.state = state || {};\r\n    this.state.path = path;\r\n    this.querystring = ~i ? path.slice(i + 1) : '';\r\n    this.pathname = ~i ? path.slice(0, i) : path;\r\n    this.params = [];\r\n  }\r\n\r\n  /**\r\n   * Expose `Context`.\r\n   */\r\n\r\n  page.Context = Context;\r\n\r\n  /**\r\n   * Push state.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Context.prototype.pushState = function(){\r\n    history.pushState(this.state, this.title, this.canonicalPath);\r\n  };\r\n\r\n  /**\r\n   * Save the context state.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Context.prototype.save = function(){\r\n    history.replaceState(this.state, this.title, this.canonicalPath);\r\n  };\r\n\r\n  /**\r\n   * Initialize `Route` with the given HTTP `path`,\r\n   * and an array of `callbacks` and `options`.\r\n   *\r\n   * Options:\r\n   *\r\n   *   - `sensitive`    enable case-sensitive routes\r\n   *   - `strict`       enable strict matching for trailing slashes\r\n   *\r\n   * @param {String} path\r\n   * @param {Object} options.\r\n   * @api private\r\n   */\r\n\r\n  function Route(path, options) {\r\n    options = options || {};\r\n    this.path = path;\r\n    this.method = 'GET';\r\n    this.regexp = pathtoRegexp(path\r\n      , this.keys = []\r\n      , options.sensitive\r\n      , options.strict);\r\n  }\r\n\r\n  /**\r\n   * Expose `Route`.\r\n   */\r\n\r\n  page.Route = Route;\r\n\r\n  /**\r\n   * Return route middleware with\r\n   * the given callback `fn()`.\r\n   *\r\n   * @param {Function} fn\r\n   * @return {Function}\r\n   * @api public\r\n   */\r\n\r\n  Route.prototype.middleware = function(fn){\r\n    var self = this;\r\n    return function(ctx, next){\r\n      if (self.match(ctx.path, ctx.params)) return fn(ctx, next);\r\n      next();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Check if this route matches `path`, if so\r\n   * populate `params`.\r\n   *\r\n   * @param {String} path\r\n   * @param {Array} params\r\n   * @return {Boolean}\r\n   * @api private\r\n   */\r\n\r\n  Route.prototype.match = function(path, params){\r\n    var keys = this.keys\r\n      , qsIndex = path.indexOf('?')\r\n      , pathname = ~qsIndex ? path.slice(0, qsIndex) : path\r\n      , m = this.regexp.exec(pathname);\r\n\r\n    if (!m) return false;\r\n\r\n    for (var i = 1, len = m.length; i < len; ++i) {\r\n      var key = keys[i - 1];\r\n\r\n      var val = 'string' == typeof m[i]\r\n        ? decodeURIComponent(m[i])\r\n        : m[i];\r\n\r\n      if (key) {\r\n        params[key.name] = undefined !== params[key.name]\r\n          ? params[key.name]\r\n          : val;\r\n      } else {\r\n        params.push(val);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * Normalize the given path string,\r\n   * returning a regular expression.\r\n   *\r\n   * An empty array should be passed,\r\n   * which will contain the placeholder\r\n   * key names. For example \"/user/:id\" will\r\n   * then contain [\"id\"].\r\n   *\r\n   * @param  {String|RegExp|Array} path\r\n   * @param  {Array} keys\r\n   * @param  {Boolean} sensitive\r\n   * @param  {Boolean} strict\r\n   * @return {RegExp}\r\n   * @api private\r\n   */\r\n\r\n  function pathtoRegexp(path, keys, sensitive, strict) {\r\n    if (path instanceof RegExp) return path;\r\n    if (path instanceof Array) path = '(' + path.join('|') + ')';\r\n    path = path\r\n      .concat(strict ? '' : '/?')\r\n      .replace(/\\/\\(/g, '(?:/')\r\n      .replace(/(\\/)?(\\.)?:(\\w+)(?:(\\(.*?\\)))?(\\?)?/g, function(_, slash, format, key, capture, optional){\r\n        keys.push({ name: key, optional: !! optional });\r\n        slash = slash || '';\r\n        return ''\r\n          + (optional ? '' : slash)\r\n          + '(?:'\r\n          + (optional ? slash : '')\r\n          + (format || '') + (capture || (format && '([^/.]+?)' || '([^/]+?)')) + ')'\r\n          + (optional || '');\r\n      })\r\n      .replace(/([\\/.])/g, '\\\\$1')\r\n      .replace(/\\*/g, '(.*)');\r\n    return new RegExp('^' + path + '$', sensitive ? '' : 'i');\r\n  };\r\n\r\n  /**\r\n   * Handle \"populate\" events.\r\n   */\r\n\r\n  function onpopstate(e) {\r\n    if (e.state) {\r\n      var path = e.state.path;\r\n      page.replace(path, e.state);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle \"click\" events.\r\n   */\r\n\r\n  function onclick(e) {\r\n    if (!which(e)) return;\r\n    if (e.metaKey || e.ctrlKey || e.shiftKey) return;\r\n    if (e.defaultPrevented) return;\r\n    var el = e.target || e.srcElement;\r\n    while (el && 'A' != el.nodeName) el = el.parentNode;\r\n    if (!el || 'A' != el.nodeName) return;\r\n    var href = el.href;\r\n    var path = el.pathname + el.search;\r\n    \r\n    // XXX: I don't think this hack will work in earlier versions of IE, \r\n    // fix to properly parse out path from href; I'm just putting this in for\r\n    // now to see if it works\r\n    if (path[0] !== '/')\r\n      path = '/' + path;\r\n    \r\n    if (el.hash || '#' == el.getAttribute('href')) return;\r\n    if (!sameOrigin(href)) return;\r\n    var orig = path;\r\n    path = path.replace(base, '');\r\n    if (base && orig == path) return;\r\n    e.preventDefault ? e.preventDefault() : e.returnValue = false;\r\n    page.show(orig);\r\n  }\r\n\r\n  /**\r\n   * Event button.\r\n   */\r\n\r\n  function which(e) {\r\n    e = e || window.event;\r\n    return null == e.which\r\n      ? e.button == 0\r\n      : e.which == 1;\r\n  }\r\n  \r\n  /**\r\n   * Check if `href` is the same origin.\r\n   */\r\n\r\n  function sameOrigin(href) {\r\n    var origin = location.protocol + '//' + location.hostname;\r\n    if (location.port) origin += ':' + location.port;\r\n    return 0 == href.indexOf(origin);\r\n  }\r\n  \r\n  /**\r\n   * Basic cross browser event code\r\n   */\r\n\r\n   function addEvent(obj, type, fn) {\r\n     if (obj.addEventListener) {\r\n       obj.addEventListener(type, fn, false);\r\n     } else {\r\n       obj.attachEvent('on' + type, fn);\r\n     }\r\n   }\r\n\r\n   function removeEvent(obj, type, fn) {\r\n     if (obj.removeEventListener) {\r\n       obj.removeEventListener(type, fn, false);\r\n     } else {\r\n       obj.detachEvent('on' + type, fn);\r\n     }\r\n   }\r\n\r\n  /**\r\n   * Expose `page`.\r\n   */\r\n\r\n  if ('undefined' == typeof module) {\r\n    window.page = page;\r\n  } else {\r\n    module.exports = page;\r\n  }\r\n\r\n})();\r\n"]}