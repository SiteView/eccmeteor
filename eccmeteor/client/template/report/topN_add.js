Template.topNofadd.rendered = function(){//监视器选择树	$(function(){				var data = SvseDao.getDetailTree();		var setting = {			check:{				enable: true,				chkStyle: "checkbox",				chkboxType: { "Y": "ps", "N": "ps" }			},						callback:{						      onchange:function (event, treeId, treeNode) {			  			      zTree = $.fn.zTree.getZTreeObj("svse_tree_check_topNadd");						     if (!treeNode && event.target.tagName.toLowerCase() != "button" && $(event.target).parents("a").length == 0) {				     zTree.cancelSelectedNode();				     show("root", event.clientX, event.clientY);			     } else if (treeNode && !treeNode.noR) {				zTree.selectNode(treeNode);				show("node", event.clientX, event.clientY);			}		}						},						data: {				simpleData: {					enable: true,					idKey: "id",					pIdKey: "pId",					rootPId: "0",				}			}		};		$.fn.zTree.init($("#svse_tree_check_topNadd"), setting, data);	});	//弹窗移动	//ModalDrag.draggable("#topNofadddiv");	///////读取检测器	Meteor.call("svGetMonitorTemplate",function(err,result){		for(name in result){			console.log(name);			var option = $("<option value="+name+"></option>").html(name)			$("#marklist").append(option);		}	}),                function zTreeOnChange(event, treeId, treeNode) {            operDiyDom(treeId, treeNode);        }		function show(type, x, y) {				$("#basicinfooftopNadd select").show();				$("body").bind("change", onBodyChange);			}				function hideMenu() {			if (basicinfooftopNadd) $("#basicinfooftopNadd").css({"visibility": "hidden"});			$("body").unbind("change", onBodyChange);		}					function onBodyChange(event){			if (!(event.target.id == "basicinfooftopNadd" || $(event.target).parents("#basicinfooftopNadd").length>0)) {				$("#basicinfooftopNadd").css({"visibility" : "hidden"});			}		}         console.log("QQQQ111");        function addTreeNode() {						var newNode = { name:"增加" + (addCount++)};			if (zTree.getSelectedNodes()[0]) {					newNode.checked = zTree.getSelectedNodes()[0].checked;					zTree.addNodes(zTree.getSelectedNodes()[0], newNode);			} else {				zTree.addNodes(null, newNode);			}		}		function removeTreeNode() {						var nodes = zTree.getSelectedNodes();			if (nodes && nodes.length>0) {				if (nodes[0].children && nodes[0].children.length > 0) {					var msg = "要删除的节点是父节点，如果删除将连同子节点一起删掉。\n\n请确认！";					if (confirm(msg)==true){						zTree.removeNode(nodes[0]);					}				} else {					zTree.removeNode(nodes[0]);				}			}		}		function checkTreeNode(checked) {			var nodes = zTree.getSelectedNodes();			if (nodes && nodes.length>0) {				zTree.checkNode(nodes[0], checked, true);			}			hideRMenu();		}				function resetTree() {						$.fn.zTree.init($("#treeDemo"), setting, zNodes);		}		Meteor.call("svGetEntity",function(err,result){				var svse = SvseTree.find({type:"entity"}).fetch();				console.log(svse); 				for(name in svse){				var option = $("<option value="+name+"></option>").html(name)				$("#Typelist").append(option);				}	});	/*Meteor.call("svGetEmailTemplates",function(err,result){		for(name in result){			console.log(name);			var option = $("<option value="+name+"></option>").html(name)			$("#Typelist").append(option);		}	});*/	Meteor.call("svGetEmailTemplates",function(err,result){		for(name in result){			//console.log(name);			var option = $("<option value="+name+"></option>").html(name)			$("#marklist").append(option);		}	});				//ModalDrag.draggable("#topNofadddiv");}//点击保存、取消按钮时的事件Template.topNofadd.events = {    'change #Typelist': function(evt) {        Session.set("selected_Typelist", evt.currentTarget.value);	    Session.set("Marklist", evt.currentTarget.value);	    console.log("yes");   },  'change #Typelist':function(){	var type=$(this).val();	//Type模板	if(type=="Default"){		$("#marklist").empty();//清空select的option		SvseMonitorTemplateDao.getMonitorTemplate(function(err,result){			for(name in result){				//console.log(name);				var option=$("<option value"+name+"></option>").html(name)				$("#marklist").append(option);			}		});	}	//mark模板	if(type=="com"){		$("#marklist").empty();//清空select的option		SvseMonitorTemplateDao.getMonitorTemplate(function(err,result){			for(name in result){				//console.log(name);				var option = $("<option value="+name+"></option>").html(name)				$("#marklist").append(option);			}		});	}},   /*"change #Typelist":function(){	                 //var index = document.getElementById('s1').selectedIndex;              if(document.getElementById("Typelist").value=="{{sv_name}}"){                document.getElementById('marklist').disabled=false;           }		   else{               document.getElementById('marklist').disabled=false;				}        },*/    "change #reporttypePeriodlist":function(){	                  if(document.getElementById("reporttypePeriodlist").value=="Week"){			                    document.getElementById("topNtypetemplatelist").disabled=false;           }		    else{				 document.getElementById("topNtypetemplatelist").disabled=true;				}        },		        "click #topNofaddcancelbtn":function(e,t){								RenderTemplate.hideParents(t);				//$('#topNofadddiv').modal('toggle');				},					          "click #topNofaddsavebtn":function(e,t){          var targets = [];	    var basicinfooftopNadd = ClientUtils.formArrayToObject($("#basicinfooftopNadd").serializeArray());	    var arr = $.fn.zTree.getZTreeObj("svse_tree_check_topNadd").getNodesByFilter(function(node){return (node.checked && node.type === "monitor")});			for(index in arr){			targets.push(arr[index].id);			}			basicinfooftopNadd["GroupRight"] = targets.join();						$(":checkbox[name='Status']").each(function(){			if(!this.checked) basicinfooftopNadd["Status"]="Yes";		});		//报告标题是否为空		var Title=basicinfooftopNadd["Title"];			if(!Title){				Message.info("请填写标题！",{align:"center",time:3});				return;		}		//报告标题是否重复判断		var result=SvseTopNDao.getTopNByName(Title);		    if(result){				Message.info("报告标题已经存在!",{align:"center",time:3});				return;		}		//E-mail的判断		var email=basicinfooftopNadd["EmailSend"];					if(!email){				Message.info("E-mail不能为空！",{align:"center",time:3});				 //alert("邮件中必须包含@");				return;         }		 //判断邮箱格式是否正确  		var mailStr =  'aa@bb.com;bb@aa.com;cc@aa.com';		var mail_arr =mailStr.split(";");		 //if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(email))      {  			if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*([,;][,;\s]*(\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)*)*$/.test(email))      {   	            Message.info("E-mail格式错误!");   	            return false;        }		var nIndex = new Date().format("yyyyMMddhhmmss") +"x"+ Math.floor(Math.random()*1000);		for(index in arr){			targets.push(arr[index].id);		}		basicinfooftopNadd["AlertTarget"] = targets.join();		    if(!basicinfooftopNadd["AlertTarget"]){				Message.info("监测范围不能为空",{align:"center",time:3});				return;		}			        var nIndex = Utils.getUUID();        basicinfooftopNadd["nIndex"] = nIndex        var address = {};		            address[nIndex] = basicinfooftopNadd;            console.log(address[nIndex]); 		              SvseTopNDao.addTopN(nIndex,address,function(result){            SystemLogger(result);			console.log(result); 			RenderTemplate.hideParents(t);              });			              }    }	   