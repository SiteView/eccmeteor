Template.statisticalofadd.rendered = function () {	//监视器选择树	$(function () {		var data = SvseDao.getDetailTree();		var setting = {			check : {				enable : true,				chkStyle : "checkbox",				chkboxType : {					"Y" : "ps",					"N" : "ps"				}			},			callback : {				onRightClick : function (event, treeId, treeNode) {					zTree = $.fn.zTree.getZTreeObj("svse_tree_check");					if (!treeNode && event.target.tagName.toLowerCase() != "button" && $(event.target).parents("a").length == 0) {						zTree.cancelSelectedNode();						showRMenu("root", event.clientX, event.clientY);					} else if (treeNode && !treeNode.noR) {						zTree.selectNode(treeNode);						showRMenu("node", event.clientX, event.clientY);					}				}			},			data : {				simpleData : {					enable : true,					idKey : "id",					pIdKey : "pId",					rootPId : "0",				}			}		};		$.fn.zTree.init($("#svse_tree_check"), setting, data);	});	function showRMenu(type, x, y) {		//$("#rMenu ul").show();		$("#rMenu").css({			"top" : y + 10 + "px",			"left" : x + 10 + "px",			"visibility" : "visible"		});		$("body").bind("mousedown", onBodyMouseDown);	}	function hideRMenu() {		if (rMenu)			$("#rMenu").css({				"visibility" : "hidden"			});		$("body").unbind("mousedown", onBodyMouseDown);	}	function onBodyMouseDown(event) {		if (!(event.target.id == "rMenu" || $(event.target).parents("#rMenu").length > 0)) {			$("#rMenu").css({				"visibility" : "hidden"			});		}	}	/*	function addTreeNode() {	hideRMenu();	var newNode = { name:"增加" + (addCount++)};	if (zTree.getSelectedNodes()[0]) {	newNode.checked = zTree.getSelectedNodes()[0].checked;	zTree.addNodes(zTree.getSelectedNodes()[0], newNode);	} else {	zTree.addNodes(null, newNode);	}	}	function removeTreeNode() {	hideRMenu();	var nodes = zTree.getSelectedNodes();	if (nodes && nodes.length>0) {	if (nodes[0].children && nodes[0].children.length > 0) {	var msg = "要删除的节点是父节点，如果删除将连同子节点一起删掉。\n\n请确认！";	if (confirm(msg)==true){	zTree.removeNode(nodes[0]);	}	} else {	zTree.removeNode(nodes[0]);	}	}	}	function checkTreeNode(checked) {	var nodes = zTree.getSelectedNodes();	if (nodes && nodes.length>0) {	zTree.checkNode(nodes[0], checked, true);	}	hideRMenu();	}	function resetTree() {	hideRMenu();	$.fn.zTree.init($("#treeDemo"), setting, zNodes);	}	}	 */	 	//$('#datetimepicker').datetimepicker();		 // $('#datepicker').datepicker();		 //鼠标悬停功能实现	$().tooltip();		 	$.fn.tooltip = function( options ) { 	return this.each(function(e) {        	// If options exist, lets merge them	// with our default settings		if ( options ) { 			$.extend( settings, options );		}		var tooltip = "";		var title = "";		$(this).mouseover(function(e){						 			title = $(this).attr("title");			if(title== ""){				 tooltip = "";			}else{				tooltip = "<div id='tooltip'><p>"+title+"</p></div>";				$(this).attr("title","");			}					$('body').append(tooltip);			$('#tooltip')				.css({				"opacity":"0.8",				"top":(e.pageY)+"px",				"left":(e.pageX)+"px"					}).show('fast');		})		$(this).mouseout(function(){			$(this).attr("title",title);			$('#tooltip').remove();						 })				$(this).mousemove(function(e){			$('#tooltip').css({				"top":(e.pageY+20)+"px",				"left":(e.pageX+10)+"px"			});									})	});	};		$(".form_datetime").datetimepicker({			format: "dd MM yyyy",			autoclose: true,			todayBtn: true,			pickerPosition: "bottom-left"		});	//弹窗移动	ModalDrag.draggable("#statisticalofadddiv");}Template.statisticalofadd.events = {"change #reporttypePeriodlist":function(){		if(document.getElementById("reporttypePeriodlist").value=="Week"){			 document.getElementById("reporttypetemplatelist").disabled=false;		}else if(document.getElementById("reporttypePeriodlist").value=="Other"){			document.getElementById("form_datetime").style.display="";			document.getElementById("form_datetimes").style.display="";			//$("#form_datetime").attr("disabled","disabled");			}else{		document.getElementById("form_datetime").style.display="none";		document.getElementById("form_datetimes").style.display="none";		document.getElementById("reporttypetemplatelist").disabled=true;		}},	"click #statisticalofaddcancelbtn" : function (e,t) {		RenderTemplate.hideParents(t);		//$('#statisticalofadddiv').modal('toggle');	},	"click #statisticalofaddsavebtn" : function (e,t) {		var basicinfoofstatisticaladd = ClientUtils.formArrayToObject($("#basicinfoofstatisticaladd").serializeArray());		//表单数据校验。		var Title = basicinfoofstatisticaladd["Title"];			if(!Title){			Message.warn("报告标题不能为空，请重新输入！");			return;		}		//报告标题是否重复判断		var result =SvseStatisticalDao.getTitle(Title);			if(result){				Message.warn("报告名称已存在，请重新输入！");			return;		}		//E-mail的判断		var email=basicinfoofstatisticaladd["EmailSend"];					if(!email){				Message.info("E-mail不能为空！");				 //alert("邮件中必须包含@");				return;         }		 //判断邮箱格式是否正确  		var mailStr =  'aa@bb.com;bb@aa.com;cc@aa.com';		var mail_arr =mailStr.split(";");		 //if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(email))      {  			if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*([,;][,;\s]*(\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)*)*$/.test(email))      {   	            Message.info("E-mail格式错误!");   	            return false;        }		var targets = [];		var arr = $.fn.zTree.getZTreeObj("svse_tree_check").getNodesByFilter(function (node) {				return (node.checked && node.type === "monitor")			});		for (index in arr) {			targets.push(arr[index].id);		}		basicinfoofstatisticaladd["GroupRight"] = targets.join();		var nIndex = Utils.getUUID();		basicinfoofstatisticaladd["nIndex"] = nIndex			console.log(basicinfoofstatisticaladd); //控制台打印添加的信息		var address = {};		address[nIndex] = basicinfoofstatisticaladd;		console.log(address[nIndex]);		SvseStatisticalDao.addStatistical(nIndex, address, function (result) {			SystemLogger(result);			console.log("123");			console.log(result); //控制台打印添加的信息			console.log("123");			RenderTemplate.hideParents(t);		});	}}