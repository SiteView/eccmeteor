Template.statisticalofadd.rendered = function () {	//监视器选择树	$(function () {		var data = SvseDao.getDetailTree();		console.log(data);		var setting = {			check : {				enable : true,				chkStyle : "checkbox",				chkboxType : {					"Y" : "ps",					"N" : "ps"				}			},			callback : {				onRightClick : function (event, treeId, treeNode) {					console.log(treeNode);					console.log(treeNode.id);					var monitor_info = Svse.findOne({sv_id:treeNode.id});						console.log(monitor_info.submonitor);						var submonitors = monitor_info.submonitor;						var submonitor_names = [];						for(s in submonitors){							var monitor = SvseTree.findOne({sv_id:submonitors[s]});														submonitor_names[s] = monitor.sv_name;						}							//console.log(submonitor_names);					zTree = $.fn.zTree.getZTreeObj("svse_tree_check");										if (!treeNode && event.target.tagName.toLowerCase() != "button" && $(event.target).parents("a").length == 0) {						zTree.cancelSelectedNode();						showRMenu("root", event.offsetX, event.offsetY);					} else if (treeNode && !treeNode.noR) {						zTree.selectNode(treeNode);						var scrollTop = $(document).scrollTop();						var scrollLeft = $(document).scrollLeft();						showRMenu("node", event.clientX + scrollLeft, event.clientY + scrollTop); 						// showRMenu("node", event.offsetX, event.offsetY);						console.log(submonitor_names);						var content = {submonitor_names:submonitor_names};						RenderTemplate.renderIn("#statistical_rMenu","statistical_add_rMenu",content);					}				}			},			data : {				simpleData : {					enable : true,					idKey : "id",					pIdKey : "pId",					rootPId : "0",				}			}		};		$.fn.zTree.init($("#svse_tree_check"), setting, data);	});	function showRMenu(type, x, y) {			if(type == "node"){			console.log("node show !!!!!!");			$("#statistical_rMenu").attr("style","display");		}else{			$("#statistical_rMenu").attr("style","display:none");		}		$("#statistical_rMenu").css({			"top" : y + "px",			"left" : x + "px",			"visibility" : "visible"		});		$("body").bind("mousedown", onBodyMouseDown);	}	function hideRMenu() {		if (statistical_rMenu)			$("#statistical_rMenu").css({				"visibility" : "hidden"			});		$("body").unbind("mousedown", onBodyMouseDown);	}	function onBodyMouseDown(event) {		if (!(event.target.id == "statistical_rMenu" || $(event.target).parents("#statistical_rMenu").length > 0)) {			$("#statistical_rMenu").css({				"visibility" : "hidden"			});		}	}		 //鼠标悬停功能实现	$().tooltip();		 	$.fn.tooltip = function( options ) { 	return this.each(function(e) {        	// If options exist, lets merge them	// with our default settings		if ( options ) { 			$.extend( settings, options );		}		var tooltip = "";		var title = "";		$(this).mouseover(function(e){						 			title = $(this).attr("title");			if(title== ""){				 tooltip = "";			}else{				tooltip = "<div id='tooltip'><p>"+title+"</p></div>";				$(this).attr("title","");			}					$('body').append(tooltip);			$('#tooltip')				.css({				"opacity":"0.8",				"top":(e.pageY)+"px",				"left":(e.pageX)+"px"					}).show('fast');		})		$(this).mouseout(function(){			$(this).attr("title",title);			$('#tooltip').remove();						 })				$(this).mousemove(function(e){			$('#tooltip').css({				"top":(e.pageY+20)+"px",				"left":(e.pageX+10)+"px"			});									})	});	};		$(".form_datetime").datetimepicker({			format: "dd MM yyyy",			autoclose: true,			todayBtn: true,			pickerPosition: "bottom-left"		});	//弹窗移动	ModalDrag.draggable("#statisticalofadddiv");}Template.statisticalofadd.events = {"change #reporttypePeriodlist":function(){		if(document.getElementById("reporttypePeriodlist").value=="Week"){			 document.getElementById("reporttypetemplatelist").disabled=false;		}else if(document.getElementById("reporttypePeriodlist").value=="Other"){			document.getElementById("form_datetime").style.display="";			document.getElementById("form_datetimes").style.display="";			//$("#form_datetime").attr("disabled","disabled");			}else{		document.getElementById("form_datetime").style.display="none";		document.getElementById("form_datetimes").style.display="none";		document.getElementById("reporttypetemplatelist").disabled=true;		}},	"click #statisticalofaddcancelbtn" : function (e,t) {		RenderTemplate.hideParents(t);		//$('#statisticalofadddiv').modal('toggle');	},	"click #statisticalofaddsavebtn" : function (e,t) {		var basicinfoofstatisticaladd = ClientUtils.formArrayToObject($("#basicinfoofstatisticaladd").serializeArray());		//表单数据校验。		var Title = basicinfoofstatisticaladd["Title"];			if(!Title){			Message.warn("报告标题不能为空，请重新输入！");			return;		}		//报告标题是否重复判断		var result =SvseStatisticalDao.getTitle(Title);			if(result){				Message.warn("报告名称已存在，请重新输入！");			return;		}		//E-mail的判断		var email=basicinfoofstatisticaladd["EmailSend"];					if(!email){				Message.info("E-mail不能为空！");				 //alert("邮件中必须包含@");				return;         }		 //判断邮箱格式是否正确  		var mailStr =  'aa@bb.com;bb@aa.com;cc@aa.com';		var mail_arr =mailStr.split(";");		 //if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(email))      {  			if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*([,;][,;\s]*(\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)*)*$/.test(email))      {   	            Message.info("E-mail格式错误!");   	            return false;        }		var targets = [];		var arr = $.fn.zTree.getZTreeObj("svse_tree_check").getNodesByFilter(function (node) {				return (node.checked && node.type === "monitor")			});		for (index in arr) {			targets.push(arr[index].id);		}		basicinfoofstatisticaladd["GroupRight"] = targets.join();		var nIndex = Utils.getUUID();		basicinfoofstatisticaladd["nIndex"] = nIndex			console.log(basicinfoofstatisticaladd); //控制台打印添加的信息		var address = {};		address[nIndex] = basicinfoofstatisticaladd;		console.log(address[nIndex]);		SvseStatisticalDao.addStatistical(nIndex, address, function (result) {			SystemLogger(result);			console.log("123");			console.log(result); //控制台打印添加的信息			console.log("123");			RenderTemplate.hideParents(t);		});	}}